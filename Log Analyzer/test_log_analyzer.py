import unittest
import json
from unittest.mock import patch

from log_analyzer import log_finder, get_urls_stat


class TestLogAnalyzer(unittest.TestCase):

    def test_parse(self):
        logs = [{'url': 'GET /api/v2/internal/html5/phantomjs/queue/?wait=1m HTTP/1.1',
                 'med': [60.089, 60.071, 60.087, 60.076, 60.127, 60.088, 60.087, 60.089, 60.092, 60.084, 60.073, 60.064,
                         60.088, 60.073, 60.414, 60.061, 60.077, 60.088, 60.08, 60.088, 60.087, 60.063, 60.105, 60.079,
                         60.102,
                         60.111, 60.067, 60.059, 60.068, 60.068, 60.095, 60.075, 60.082, 60.099, 60.086, 60.075, 60.083,
                         60.07,
                         60.109, 60.08, 60.072, 60.09, 60.054, 60.074, 60.153, 60.072, 60.086, 60.068, 60.073, 60.141,
                         60.078,
                         60.123, 60.085, 60.09, 60.098, 60.085, 60.072, 60.082, 60.073, 60.072, 60.062, 60.095, 60.093,
                         60.069,
                         60.074, 60.075, 60.077, 60.06, 60.064, 60.078, 60.07, 60.068, 60.089, 60.09, 60.089, 60.085,
                         60.065,
                         60.077, 60.064, 60.078, 60.087, 60.079, 60.104, 60.089, 60.059, 60.072, 60.063, 60.073, 60.073,
                         60.071, 60.096, 60.118, 60.068, 60.074, 60.064, 60.081, 60.062, 60.075, 60.075, 60.072, 60.104,
                         60.086, 60.063, 60.093, 60.107, 60.066, 60.071, 60.053, 60.084, 60.078, 60.074, 60.092, 60.312,
                         60.058, 60.066, 60.073, 60.066, 60.058, 60.076, 60.173, 60.094, 60.07, 60.064, 60.075, 60.079,
                         60.081,
                         60.065, 60.077, 60.076, 60.066, 60.071, 60.083, 60.102, 60.079, 60.075, 60.057, 60.053, 60.058,
                         60.063, 60.072, 60.068, 60.08, 60.071, 60.069, 60.101, 60.059, 60.066, 60.079, 60.057, 60.095,
                         60.098,
                         60.062, 60.105, 60.076, 60.066, 60.082, 60.064, 60.074, 60.122, 60.074, 60.072, 60.136, 60.07,
                         60.091,
                         60.078, 60.076, 60.072, 60.067, 60.065, 60.102, 60.06, 60.085, 60.082, 60.085, 60.083, 60.065,
                         60.065,
                         60.08, 60.075, 60.076, 60.06, 60.079, 60.066, 60.062, 60.067, 60.069, 60.077, 60.058, 60.056,
                         60.058,
                         60.068, 60.062, 60.069, 60.061, 60.059, 60.083, 60.063, 60.051, 60.065, 60.061, 60.076, 60.065,
                         60.08,
                         60.067, 60.061, 60.064, 60.08, 60.075, 60.061, 60.065, 60.259, 60.097, 60.059, 60.067, 60.063,
                         60.079,
                         60.055, 60.054, 60.062, 60.064, 60.071, 60.071, 60.059, 60.059, 60.065, 60.058, 60.08, 60.052,
                         60.065,
                         60.073, 60.1, 60.132, 60.052, 60.084, 60.068, 60.076, 60.075, 60.101, 60.082, 60.069, 60.079,
                         60.058,
                         60.058, 60.075, 60.064, 60.083, 60.071, 60.089, 60.064, 60.06, 60.102, 60.091, 60.077, 60.082,
                         60.075,
                         60.077, 60.049, 60.063, 60.294, 60.062, 60.1, 60.073, 60.104, 60.064, 60.075, 60.079, 60.061,
                         60.072,
                         60.07, 60.079, 60.113, 60.064, 61.344, 60.063, 60.075, 60.086, 60.139, 60.077, 60.086, 60.076,
                         60.071,
                         60.071, 60.073, 60.081, 60.065, 60.079, 60.073, 60.07, 60.058, 60.058, 60.109, 60.08, 60.102,
                         60.072,
                         60.058, 60.066, 60.073, 60.082, 60.059, 60.064, 60.071, 60.074, 60.073, 60.071, 60.062, 60.068,
                         60.096, 60.064, 60.076, 60.1, 60.078, 60.079, 60.057, 60.068, 60.068, 60.057, 60.07, 60.072,
                         60.463,
                         60.08, 60.069, 60.077, 60.896, 60.068, 60.073, 60.064, 60.063, 60.059, 60.072, 60.458, 60.073,
                         60.099,
                         60.071, 60.054, 60.06, 60.054, 60.059, 60.076, 60.061, 60.071, 60.09, 60.077, 60.07, 60.076,
                         60.07,
                         60.064, 60.068, 60.094, 60.089, 60.114, 60.065, 60.075, 60.105, 60.085, 60.076, 60.06, 60.088,
                         60.05,
                         60.066, 60.062, 60.054, 60.077, 60.073, 60.07, 60.074, 60.067, 60.059, 60.08, 60.33, 60.058,
                         60.093,
                         60.09, 60.072, 60.094, 60.073, 60.082, 60.078, 60.076, 60.076, 60.082, 60.097, 60.106, 60.102,
                         60.075,
                         60.081, 60.073, 60.096, 60.08, 60.072, 60.087, 60.077, 60.087, 60.061, 60.081, 60.1, 60.071,
                         60.062,
                         60.07, 60.066, 60.084, 60.389, 60.058, 60.074, 60.058, 60.057, 60.064, 60.059, 60.066, 60.07,
                         60.079,
                         60.127, 60.071, 60.115, 60.062, 60.083, 60.059, 60.056, 60.073, 60.102, 60.348, 60.102, 60.068,
                         60.078, 60.065, 60.067, 60.078, 60.061, 60.073, 60.085, 60.353, 60.073, 60.073, 60.058, 60.063,
                         60.077, 60.065, 60.06, 60.06, 60.067, 60.082, 60.074, 60.066, 60.071, 60.058, 60.064, 60.066,
                         60.063,
                         60.063, 60.068, 60.09, 60.091, 60.082, 60.073, 60.067, 60.082, 60.129, 60.065, 60.065, 60.062,
                         60.082,
                         60.061, 60.067, 60.069, 60.064, 60.069, 60.058, 60.065, 60.069, 60.086, 60.111, 60.081, 60.057,
                         60.075, 60.062, 60.067, 60.071, 60.057, 60.086, 60.067, 60.07, 60.087, 60.062, 60.091, 60.064,
                         60.078,
                         60.055, 60.055, 60.071, 60.076, 60.075, 60.06, 60.079], 'count': 492, 'time_max': 60.089,
                 'time_sum': 29562.197},
                {'url': 'GET /api/v2/internal/gpmd_plan_report/queue/?wait=1m&worker=5 HTTP/1.1',
                 'med': [60.286, 60.224, 60.132, 60.153, 60.171, 60.146, 60.194, 60.15, 60.196, 60.21,
                         60.208, 60.139, 60.33, 60.277, 60.218, 60.2, 60.235, 60.134, 60.175, 60.157,
                         60.129, 60.129, 60.202, 60.137, 60.118, 60.151, 60.254, 60.191, 60.226,
                         60.245, 60.153, 60.122, 60.121, 60.154, 60.276, 60.11, 60.143, 60.46, 60.122,
                         60.101, 60.188, 60.149, 60.112, 60.221, 60.105, 60.175, 60.193, 60.104,
                         60.17, 60.11, 60.131, 60.174, 60.103, 60.141, 60.084, 60.12, 60.145, 60.126,
                         60.175, 60.117, 60.204, 60.12, 60.141, 60.2, 60.101, 60.125, 60.16, 60.115,
                         60.101, 60.14, 60.122, 60.132, 60.124, 60.115, 60.267, 60.26, 60.126, 60.102,
                         60.12, 60.105, 60.103, 60.203, 60.125, 60.119, 60.101, 60.094, 60.141,
                         60.161, 60.117, 60.118, 60.156, 60.152, 60.127, 60.077, 60.09, 60.12, 60.171,
                         60.156, 60.101, 60.131, 60.113, 60.162, 60.101, 60.111, 60.119, 60.11,
                         60.149, 60.11, 60.214, 60.101, 60.101, 60.132, 60.104, 60.148, 60.125,
                         60.111, 60.152, 60.141, 60.149, 60.108, 60.144, 60.136, 60.121, 60.106,
                         60.111, 60.113, 60.124, 60.601, 60.123, 60.114, 60.142, 60.125, 60.108,
                         60.124, 60.101, 60.1, 60.096, 60.091, 60.164, 60.113, 60.28, 60.182, 60.163,
                         60.088, 60.09, 60.116, 60.131, 60.105, 60.102, 60.11, 60.14, 60.126, 60.101,
                         60.118, 60.144, 60.169, 60.126, 60.119, 60.133, 60.124, 60.114, 60.13,
                         60.143, 60.107, 60.099, 60.122, 60.124, 60.097, 60.107, 60.103, 60.101,
                         60.112, 60.133, 60.121, 60.099, 60.329, 60.489, 60.135, 60.158, 60.199,
                         60.115, 60.098, 60.186, 60.124, 60.115, 60.148, 60.12, 60.114, 60.1, 60.109,
                         60.112, 60.494, 60.144, 60.111, 60.124, 60.117, 60.21, 60.144, 60.103,
                         60.096, 60.138, 60.168, 60.12, 60.089, 60.099, 60.149, 60.162, 60.141,
                         60.129, 60.108, 60.2, 60.214, 60.114, 60.101, 60.169, 60.1, 60.134, 60.119,
                         60.124, 60.112, 60.18, 60.134, 60.104, 60.117, 60.107, 60.163, 60.12, 60.085,
                         60.104, 60.093, 60.109, 60.096, 60.114, 60.117, 60.1, 60.117, 60.141, 60.123,
                         60.145, 60.213, 60.136, 60.139, 60.113, 60.11, 60.097, 60.105, 60.11],
                 'count': 247, 'time_max': 60.286, 'time_sum': 14855.738},
                {'url': 'GET /api/v2/internal/gpmd_plan_report/queue/?wait=1m&worker=4 HTTP/1.1',
                 'med': [60.107, 60.126, 60.143, 60.112, 60.14, 60.138, 60.153, 60.135, 60.11, 60.139, 60.225, 60.116,
                         60.242,
                         60.187, 60.134, 60.11, 60.432, 60.117, 60.127, 60.11, 60.111, 60.275, 60.125, 60.126, 60.28,
                         60.191,
                         60.237, 60.182, 60.107, 60.147, 60.139, 60.211, 60.149, 60.161, 60.134, 60.161, 60.137, 60.16,
                         60.108,
                         60.126, 60.32, 60.166, 60.113, 60.123, 60.117, 60.143, 60.115, 60.12, 60.139, 60.092, 60.112,
                         60.1,
                         60.086, 60.147, 60.117, 60.108, 60.119, 60.121, 60.107, 60.204, 60.136, 60.124, 60.11, 60.103,
                         60.113,
                         60.099, 60.097, 60.103, 60.147, 60.119, 60.154, 60.148, 60.098, 60.124, 60.129, 60.113, 60.131,
                         60.103, 60.111, 60.131, 60.15, 60.107, 60.144, 60.133, 60.112, 60.142, 60.142, 60.113, 60.101,
                         60.156,
                         60.117, 60.122, 60.116, 60.099, 60.142, 60.129, 60.128, 60.152, 60.14, 60.108, 60.138, 60.148,
                         60.099,
                         60.118, 60.131, 60.109, 60.097, 60.134, 60.155, 60.119, 60.104, 60.128, 60.105, 60.102, 60.151,
                         60.445, 60.206, 60.099, 60.154, 60.095, 60.123, 60.122, 60.096, 60.115, 60.104, 60.109, 60.124,
                         60.106, 60.129, 60.194, 60.176, 60.136, 60.119, 60.095, 60.13, 60.139, 60.105, 60.131, 60.157,
                         60.108,
                         60.111, 60.134, 60.126, 60.118, 60.145, 60.141, 60.13, 60.106, 60.104, 60.095, 60.15, 60.132,
                         60.136,
                         60.16, 60.131, 60.089, 60.107, 60.091, 60.115, 60.1, 60.147, 60.104, 60.129, 60.087, 60.148,
                         60.117,
                         60.111, 60.132, 60.096, 60.1, 60.126, 60.102, 60.144, 60.11, 60.103, 60.164, 60.196, 60.117,
                         60.176,
                         60.161, 60.196, 60.14, 60.156, 60.105, 60.117, 60.15, 60.12, 60.115, 60.126, 60.557, 60.144,
                         60.163,
                         60.12, 60.112, 60.111, 60.157, 60.159, 60.144, 60.155, 60.103, 60.108, 60.139, 60.135, 60.117,
                         60.106,
                         60.098, 60.165, 60.125, 60.12, 60.104, 60.124, 60.161, 60.094, 60.095, 60.086, 60.095, 60.104,
                         60.126,
                         60.108, 60.121, 60.163, 60.142, 60.102, 60.101, 60.472, 60.158, 60.115, 60.087, 60.097, 60.094,
                         60.121, 60.109, 60.097, 60.094, 60.152, 60.159, 60.474, 60.103, 60.106, 60.105, 60.114, 60.122,
                         60.101, 60.094, 60.122, 60.104, 60.093], 'count': 247, 'time_max': 60.107,
                 'time_sum': 14853.613},
                {'url': 'GET /api/v2/internal/gpmd_plan_report/queue/?wait=1m&worker=2 HTTP/1.1',
                 'med': [60.174, 60.175, 60.186, 60.152, 60.117, 60.145, 60.242, 60.106, 60.185, 60.203, 60.153, 60.126,
                         60.128, 60.118, 60.084, 60.183, 60.163, 60.203, 60.184, 60.166, 60.243, 60.216, 60.218, 60.192,
                         60.248, 60.299, 60.158, 60.114, 60.121, 60.188, 60.161, 60.125, 60.102, 60.13, 60.171, 60.145,
                         60.316,
                         60.101, 60.156, 60.142, 60.143, 60.128, 60.123, 60.11, 60.119, 60.138, 60.137, 60.118, 60.111,
                         60.107,
                         60.137, 60.179, 60.125, 60.158, 60.119, 60.122, 60.13, 60.084, 60.087, 60.236, 60.123, 60.146,
                         60.102,
                         60.133, 60.117, 60.141, 60.134, 60.121, 60.113, 60.118, 60.19, 60.164, 60.136, 60.149, 60.26,
                         60.144,
                         60.115, 60.113, 60.189, 60.127, 60.11, 60.115, 60.182, 60.14, 60.106, 60.132, 60.131, 60.112,
                         60.112,
                         60.112, 60.132, 60.138, 60.099, 60.13, 60.108, 60.123, 60.131, 60.109, 60.115, 60.084, 60.164,
                         60.141,
                         60.129, 60.112, 60.123, 60.129, 60.145, 60.125, 60.114, 60.094, 60.13, 60.121, 60.101, 60.11,
                         60.129,
                         60.139, 60.172, 60.134, 60.086, 60.135, 60.16, 60.103, 60.109, 60.125, 60.108, 60.121, 60.116,
                         60.116,
                         60.109, 60.264, 60.12, 60.168, 60.156, 60.087, 60.184, 60.141, 60.093, 60.087, 60.123, 60.11,
                         60.132,
                         60.104, 60.107, 60.112, 60.165, 60.14, 60.171, 60.12, 60.12, 60.109, 60.11, 60.15, 60.114,
                         60.153,
                         60.133, 60.121, 60.106, 60.103, 60.104, 60.232, 60.105, 60.101, 60.138, 60.105, 60.118, 60.133,
                         60.13,
                         60.098, 60.113, 60.138, 60.122, 60.11, 60.093, 60.107, 60.102, 60.35, 60.173, 60.118, 60.105,
                         60.12,
                         60.111, 60.132, 60.146, 60.151, 60.109, 60.113, 60.133, 60.147, 60.118, 60.232, 60.249, 60.159,
                         60.136, 60.147, 60.129, 60.112, 60.144, 60.117, 60.127, 60.105, 60.121, 60.155, 60.113, 60.116,
                         60.143, 60.159, 60.154, 60.136, 60.13, 60.102, 60.148, 60.125, 60.13, 60.114, 60.135, 60.113,
                         60.124,
                         60.097, 60.166, 60.138, 60.106, 60.115, 60.12, 60.151, 60.12, 60.141, 60.117, 60.099, 60.094,
                         60.104,
                         60.104, 60.092, 60.118, 60.09, 60.117, 60.119, 60.111, 60.077, 60.102, 60.105, 60.138, 60.157,
                         60.118,
                         60.11, 60.132, 60.087, 60.115], 'count': 247, 'time_max': 60.174, 'time_sum': 14853.419},
                {'url': 'GET /api/v2/internal/gpmd_plan_report/queue/?wait=1m&worker=1 HTTP/1.1',
                 'med': [60.205, 60.118, 60.265, 60.113, 60.105, 60.123, 60.203, 60.124, 60.097, 60.138, 60.127, 60.139,
                         60.247, 60.144, 60.114, 60.154, 60.128, 60.187, 60.264, 60.223, 60.125, 60.27, 60.128, 60.139,
                         60.119,
                         60.132, 60.138, 60.123, 60.124, 60.14, 60.198, 60.131, 60.116, 60.112, 60.124, 60.128, 60.156,
                         60.158,
                         60.105, 60.222, 60.123, 60.109, 60.098, 60.139, 60.117, 60.131, 60.131, 60.13, 60.116, 60.136,
                         60.14,
                         60.145, 60.422, 60.126, 60.138, 60.112, 60.123, 60.174, 60.111, 60.119, 60.201, 60.145, 60.125,
                         60.13,
                         60.096, 60.086, 60.131, 60.108, 60.09, 60.159, 60.143, 60.141, 60.104, 60.119, 60.258, 60.134,
                         60.138,
                         60.14, 60.112, 60.173, 60.125, 60.121, 60.114, 60.114, 60.124, 60.124, 60.19, 60.145, 60.1,
                         60.173,
                         60.128, 60.11, 60.131, 60.21, 60.098, 60.134, 60.098, 60.091, 60.101, 60.118, 60.108, 60.12,
                         60.107,
                         60.131, 60.108, 60.153, 60.115, 60.163, 60.095, 60.106, 60.113, 60.102, 60.102, 60.111, 60.115,
                         60.112, 60.121, 60.244, 60.134, 60.145, 60.178, 60.128, 60.149, 60.12, 60.101, 60.095, 60.096,
                         60.142,
                         60.101, 60.085, 60.095, 60.139, 60.17, 60.118, 60.183, 60.185, 60.142, 60.115, 60.104, 60.106,
                         60.086,
                         60.379, 60.102, 60.117, 60.191, 60.172, 60.138, 60.131, 60.128, 60.104, 60.189, 60.148, 60.084,
                         60.162, 60.101, 60.097, 60.128, 60.096, 60.117, 60.143, 60.11, 60.156, 60.108, 60.101, 60.122,
                         60.12,
                         60.109, 60.118, 60.175, 60.103, 60.11, 60.105, 60.118, 60.101, 60.124, 60.147, 60.143, 60.107,
                         60.139,
                         60.132, 60.125, 60.14, 60.151, 60.155, 60.102, 60.16, 60.141, 60.129, 60.13, 60.16, 60.122,
                         60.125,
                         60.123, 60.093, 60.132, 60.113, 60.191, 60.166, 60.192, 60.081, 60.287, 60.128, 60.115, 60.106,
                         60.39,
                         60.102, 60.119, 60.105, 60.12, 60.125, 60.12, 60.106, 60.095, 60.097, 60.103, 60.096, 60.118,
                         60.103,
                         60.098, 60.114, 60.133, 60.108, 60.162, 60.096, 60.107, 60.127, 60.192, 60.095, 60.116, 60.105,
                         60.109, 60.096, 60.11, 60.106, 60.12, 60.091, 60.106, 60.135, 60.124, 60.11, 60.117, 60.117,
                         60.109,
                         60.105, 60.113, 60.113, 60.093], 'count': 247, 'time_max': 60.205, 'time_sum': 14853.039},
                {'url': 'GET /api/v2/internal/gpmd_plan_report/queue/?wait=1m&worker=3 HTTP/1.1',
                 'med': [60.133, 60.136, 60.196, 60.208, 60.157, 60.165, 60.142, 60.158, 60.12, 60.123, 60.165, 60.262,
                         60.116,
                         60.124, 60.214, 60.165, 60.154, 60.18, 60.172, 60.138, 60.129, 60.125, 60.098, 60.154, 60.165,
                         60.137,
                         60.141, 60.186, 60.156, 60.206, 60.171, 60.199, 60.147, 60.136, 60.155, 60.155, 60.12, 60.113,
                         60.118,
                         60.184, 60.118, 60.518, 60.114, 60.145, 60.157, 60.12, 60.112, 60.105, 60.139, 60.108, 60.145,
                         60.126,
                         60.213, 60.286, 60.129, 60.185, 60.142, 60.117, 60.116, 60.16, 60.119, 60.14, 60.157, 60.171,
                         60.155,
                         60.145, 60.109, 60.108, 60.172, 60.155, 60.129, 60.139, 60.109, 60.101, 60.163, 60.11, 60.107,
                         60.14,
                         60.173, 60.11, 60.11, 60.16, 60.106, 60.195, 60.13, 60.197, 60.124, 60.105, 60.155, 60.172,
                         60.097,
                         60.106, 60.139, 60.117, 60.104, 60.131, 60.094, 60.089, 60.145, 60.12, 60.098, 60.12, 60.101,
                         60.089,
                         60.09, 60.145, 60.109, 60.118, 60.1, 60.106, 60.149, 60.105, 60.144, 60.103, 60.128, 60.269,
                         60.103,
                         60.158, 60.21, 60.116, 60.109, 60.114, 60.139, 60.119, 60.111, 60.126, 60.165, 60.108, 60.123,
                         60.272,
                         60.164, 60.105, 60.123, 60.169, 60.129, 60.141, 60.095, 60.128, 60.135, 60.103, 60.115, 60.243,
                         60.122, 60.113, 60.099, 60.235, 60.112, 60.158, 60.097, 60.147, 60.092, 60.098, 60.207, 60.136,
                         60.211, 60.285, 60.197, 60.121, 60.148, 60.166, 60.192, 60.114, 60.17, 60.1, 60.145, 60.181,
                         60.126,
                         60.169, 60.109, 60.139, 60.136, 60.113, 60.136, 60.12, 60.106, 60.113, 60.144, 60.155, 60.173,
                         60.127,
                         60.108, 60.152, 60.122, 60.169, 60.208, 60.159, 60.137, 60.138, 60.201, 60.207, 60.144, 60.189,
                         60.095, 62.022, 60.159, 60.144, 60.142, 60.158, 60.12, 60.117, 60.117, 60.192, 60.135, 60.148,
                         60.152,
                         60.169, 60.112, 60.135, 60.136, 60.155, 60.198, 60.09, 60.115, 60.127, 60.23, 60.124, 60.105,
                         60.145,
                         60.124, 60.098, 60.104, 60.118, 60.104, 60.126, 60.114, 60.133, 60.111, 60.088, 60.106, 60.109,
                         60.115, 60.144, 60.106, 60.108, 60.126, 60.1, 60.096, 60.109, 60.118, 60.11, 60.139, 60.129,
                         60.119,
                         60.112, 60.091, 60.11], 'count': 246, 'time_max': 60.133, 'time_sum': 14796.538},
                {'url': 'GET /export/ivi/200010-impression.csv HTTP/1.0',
                 'med': [16.277, 16.308, 16.444, 16.372, 16.405, 16.347, 16.327, 16.476, 16.442, 16.266, 16.393, 16.297,
                         16.316, 16.297, 16.445, 16.243, 16.443, 16.205, 16.299, 16.272, 16.408, 16.391, 16.513, 16.496,
                         16.357, 16.252, 16.287, 16.333, 16.44, 16.267, 16.42, 16.45, 16.395, 16.365, 16.392, 16.336,
                         16.415,
                         16.464, 16.228, 16.493, 16.323, 16.318, 16.236, 16.39, 16.32, 16.382, 16.509, 16.322, 16.348,
                         16.336,
                         16.424, 16.607, 16.2, 16.247, 16.561, 16.303, 16.379, 16.437, 16.381, 16.416, 16.538, 16.402,
                         16.555,
                         16.533, 19.585, 16.249, 16.425, 16.282, 16.486, 16.398, 16.296, 16.275, 16.453, 16.371, 16.416,
                         16.57,
                         16.386, 16.544, 16.478, 16.328, 16.415, 16.437, 16.297, 16.441, 16.329, 16.379, 16.344, 16.28,
                         16.35,
                         16.407, 16.244, 16.387, 16.37, 16.253, 16.329, 16.267, 16.269, 16.398, 16.34, 17.11, 16.405,
                         16.671,
                         16.379, 16.469, 16.833, 16.72, 16.147, 16.26, 16.223, 16.324, 16.403, 16.465, 16.469, 16.393,
                         16.366,
                         16.599, 16.288, 16.322, 16.232, 16.435, 16.408, 16.289, 16.354, 16.564, 16.749, 17.029, 16.345,
                         16.307, 16.298, 16.249, 16.501, 16.414, 16.527, 16.345, 16.431, 17.212, 16.187, 16.519, 16.201,
                         16.495, 16.41, 16.273, 16.278, 16.506, 16.654, 16.205, 17.359, 16.566, 18.81, 16.797, 16.331,
                         16.192,
                         16.279, 16.352, 16.479, 16.356, 16.443, 16.454, 16.272, 16.542, 16.511, 16.239, 16.286, 16.471,
                         17.244, 16.37, 16.449, 16.356, 16.517, 16.374, 16.443, 16.217, 16.488, 16.348, 16.536, 16.26,
                         16.638,
                         16.457, 16.309, 16.452, 16.194, 16.563, 16.615, 16.379, 16.336, 16.395, 16.537, 16.38, 19.447,
                         16.528,
                         16.496, 16.327, 16.864, 16.415, 16.624, 16.434, 16.614, 16.17, 16.491, 16.31, 16.373, 16.352,
                         16.398,
                         16.324, 16.314, 17.183, 16.234, 16.484, 16.506, 16.464, 16.225, 17.045, 16.356, 16.439, 16.359,
                         16.149, 16.425, 16.487, 16.816, 16.634, 16.335, 16.666, 16.304, 16.607, 16.409, 16.162, 16.473,
                         16.368, 17.465, 16.735], 'count': 230, 'time_max': 16.277, 'time_sum': 3786.791},
                {'url': 'GET /campaigns/7854376/banners/? HTTP/1.1',
                 'med': [12.128, 12.678, 11.241, 13.463, 14.472, 15.122, 12.382, 13.426, 12.326, 13.249, 14.221, 13.568,
                         14.279, 13.623, 11.846, 12.124, 12.777, 13.643, 12.156, 12.818, 12.216, 14.873, 14.247, 15.383,
                         11.989, 13.824, 14.389, 13.111, 12.303, 12.478, 16.45, 12.179, 12.454, 16.125, 11.785, 12.953,
                         11.979,
                         14.762, 13.262, 14.707, 12.976, 13.639, 12.957, 12.829, 12.136, 12.923, 12.358, 12.286, 12.133,
                         12.72,
                         12.812, 15.183, 12.435, 12.802, 12.438, 10.861, 13.389, 11.633, 11.76, 11.865, 12.252, 11.806,
                         12.629,
                         15.393, 17.762, 18.645, 12.132, 12.751, 12.771, 12.322, 13.137, 12.955, 15.082, 12.165, 15.337,
                         13.271, 12.418, 12.571, 13.095, 17.45, 13.327, 14.659, 13.905, 14.23, 11.824, 12.174, 13.912,
                         12.016,
                         12.01, 13.088, 12.778, 13.453, 12.39, 14.558, 14.414, 14.165, 14.463, 14.101, 12.288, 13.681,
                         12.561,
                         12.237, 12.885, 12.466, 14.826, 12.283, 12.266, 13.086, 13.014, 13.217, 12.445, 13.365, 12.382,
                         13.588, 12.771, 12.697, 13.113, 13.336, 11.818, 12.567, 16.327, 12.735, 12.936], 'count': 123,
                 'time_max': 12.128, 'time_sum': 1627.447}, {'url': 'GET /campaigns/7854473/banners/? HTTP/1.1',
                                                             'med': [10.346, 10.118, 11.541, 11.376, 13.388, 13.839,
                                                                     10.084,
                                                                     11.572, 10.936, 10.99, 9.996, 9.843, 10.321,
                                                                     10.966,
                                                                     10.257, 10.563, 9.811, 10.873, 11.794, 10.605,
                                                                     9.139,
                                                                     11.245, 10.977, 9.865, 11.186, 10.456, 10.16,
                                                                     11.995,
                                                                     10.036, 10.699, 13.149, 9.975, 11.492, 11.544,
                                                                     10.834,
                                                                     11.979, 10.526, 12.578, 10.382, 11.806, 10.211,
                                                                     9.742,
                                                                     10.97, 10.992, 10.091, 11.85, 9.903, 9.387, 10.26,
                                                                     10.55,
                                                                     9.674, 9.962, 11.521, 10.231, 10.758, 11.15,
                                                                     12.012,
                                                                     10.266, 9.367, 9.298, 12.107, 10.51, 9.603, 11.514,
                                                                     10.58,
                                                                     12.004, 9.669, 13.935, 9.835, 11.187, 9.987,
                                                                     10.001, 9.78,
                                                                     10.934, 11.691, 10.229, 11.032, 9.799, 11.376,
                                                                     11.305,
                                                                     10.666, 9.134, 10.919, 10.391, 10.388, 11.637,
                                                                     10.928,
                                                                     10.668, 9.973, 10.163, 9.885, 9.548, 10.504,
                                                                     12.477,
                                                                     11.388, 12.861, 12.18, 11.042, 10.954, 10.546,
                                                                     10.316,
                                                                     9.678, 10.023, 10.339, 12.354, 10.002, 10.08,
                                                                     10.107,
                                                                     11.654, 9.98, 11.323, 10.263, 10.704, 11.399,
                                                                     10.39,
                                                                     12.421, 10.911, 12.37, 10.855, 9.897, 10.3, 10.958,
                                                                     11.344], 'count': 123, 'time_max': 10.346,
                                                             'time_sum': 1328.435},
                {'url': 'GET /api/v2/internal/slots HTTP/1.1',
                 'med': [26.455, 29.822, 26.96, 28.503, 16.448, 28.273, 27.811, 22.84, 28.997, 10.625, 24.342, 26.726,
                         29.117,
                         36.195, 11.066, 23.189, 26.14, 19.696, 28.601, 11.99, 20.978, 20.81, 19.028, 24.872, 12.802,
                         21.579,
                         22.8, 20.087, 23.109, 13.192, 31.791, 25.768, 28.721, 28.698, 11.034, 25.641, 24.635, 19.19,
                         26.759,
                         12.225, 22.574], 'count': 41, 'time_max': 26.455, 'time_sum': 940.089}]

        string = [{"url": "GET /api/v2/internal/html5/phantomjs/queue/?wait=1m HTTP/1.1", "med": 60.073, "count": 492,
                   "time_max": 60.089, "time_sum": 29562.197, "time_perc": 10.856, "time_avg": 60.086,
                   "count_perc": 0.114},
                  {"url": "GET /api/v2/internal/gpmd_plan_report/queue/?wait=1m&worker=5 HTTP/1.1", "med": 60.124,
                   "count": 247, "time_max": 60.286, "time_sum": 14855.738, "time_perc": 5.456, "time_avg": 60.145,
                   "count_perc": 0.057},
                  {"url": "GET /api/v2/internal/gpmd_plan_report/queue/?wait=1m&worker=4 HTTP/1.1", "med": 60.122,
                   "count": 247, "time_max": 60.107, "time_sum": 14853.613, "time_perc": 5.455, "time_avg": 60.136,
                   "count_perc": 0.057},
                  {"url": "GET /api/v2/internal/gpmd_plan_report/queue/?wait=1m&worker=2 HTTP/1.1", "med": 60.125,
                   "count": 247, "time_max": 60.174, "time_sum": 14853.419, "time_perc": 5.455, "time_avg": 60.135,
                   "count_perc": 0.057},
                  {"url": "GET /api/v2/internal/gpmd_plan_report/queue/?wait=1m&worker=1 HTTP/1.1", "med": 60.123,
                   "count": 247, "time_max": 60.205, "time_sum": 14853.039, "time_perc": 5.455, "time_avg": 60.134,
                   "count_perc": 0.057},
                  {"url": "GET /api/v2/internal/gpmd_plan_report/queue/?wait=1m&worker=3 HTTP/1.1", "med": 60.13,
                   "count": 246, "time_max": 60.133, "time_sum": 14796.538, "time_perc": 5.434, "time_avg": 60.149,
                   "count_perc": 0.057},
                  {"url": "GET /export/ivi/200010-impression.csv HTTP/1.0", "med": 16.393, "count": 230,
                   "time_max": 16.277, "time_sum": 3786.791, "time_perc": 1.391, "time_avg": 16.464,
                   "count_perc": 0.053},
                  {"url": "GET /campaigns/7854376/banners/? HTTP/1.1", "med": 12.885, "count": 123, "time_max": 12.128,
                   "time_sum": 1627.447, "time_perc": 0.598, "time_avg": 13.231, "count_perc": 0.029},
                  {"url": "GET /campaigns/7854473/banners/? HTTP/1.1", "med": 10.605, "count": 123, "time_max": 10.346,
                   "time_sum": 1328.435, "time_perc": 0.488, "time_avg": 10.8, "count_perc": 0.029},
                  {"url": "GET /api/v2/internal/slots HTTP/1.1", "med": 24.342, "count": 41, "time_max": 26.455,
                   "time_sum": 940.089, "time_perc": 0.345, "time_avg": 22.929, "count_perc": 0.01}]
        p_string = get_urls_stat(logs, 431421, 272307.06399974105)
        self.assertAlmostEqual(json.dumps(string), p_string)

    def test_log_finder(self):
        file_names = [
            '.\\nginx-access-ui.log-20170627.gz', '.\\nginx-access-ui.log-20170628.gz',
            '.\\nginx-access-ui.log-20170629.gz', '.\\nginx-access-ui.log-20170630.gz',
        ]
        with patch('glob.glob', lambda dir_path: file_names):
            self.assertEqual(
                log_finder('./', 'nginx-access-ui*'),
                '.\\nginx-access-ui.log-20170630.gz'
            )
